<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!-- Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved. -->
<head>
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE7">
<title>Iteration Dashboard</title>
<meta name="Name" content="Mashup: Iteration Dashboard"/>
<meta name="Version" content="2010.05.28"/>
<meta name="Vendor" content="Rally Software"/>
<link rel="stylesheet" type="text/css" href="/slm/css/rally/core.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="/slm/css/slm.css" charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="/slm/js-lib/dojo/1.3.1/dijit/themes/nihilo/nihilo.css">

<script type="text/javascript" description="CSS Selection">
    var fileref = document.createElement("link");
    fileref.setAttribute("rel", "stylesheet");
    fileref.setAttribute("type", "text/css");
    if ('__MODE__' == 'widget') {
        fileref.setAttribute("href", "/slm/mashup/1.15/css/widget.css");
    } else {
        fileref.setAttribute("href", "/slm/mashup/1.15/css/mashup.css");
    }
    document.getElementsByTagName("head")[0].appendChild(fileref);
</script>

<script type="text/javascript" src="/slm/js-lib/dojo/1.3.1/dojo/dojo.js"></script>
<script type="text/javascript">
    dojo.require('dijit.TitlePane');
</script>
<script type="text/javascript" src="/slm/js/help.js"></script>
<script type="text/javascript" src="/slm/js/slm.js"></script>
<script type="text/javascript" src="/slm/js-lib/ejsc/2.0.1/EJSChart.js"></script>
<script type="text/javascript" src="/slm/mashup/1.15/js/utilities.js"></script>
<script type="text/javascript" src="/slm/mashup/1.15/js/dropdown.js"></script>
<script type="text/javascript" src="/slm/mashup/1.15/js/batch-toolkit.js"></script>
<script type="text/javascript" src="/slm/mashup/1.16/js/pie.js"></script>
<script type="text/javascript" src="/slm/mashup/1.15/js/legend.js"></script>


<script type="text/javascript">
/*
 Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved.
 SuperCustomizableUtilities.js
 */
var DEFINED_STATE = (typeof DEFINED_STATE === "undefined") ? "Defined" : DEFINED_STATE;
function addDaysToDate(a, b) {
    return(a.getTime() + RALLY.Mashup.Utilities.convertDaysToMilliseconds(b))
}
function isValidChartDate(b, c, a) {
    return(RALLY.Mashup.Utilities.isWorkDay(b) && b >= c && b <= a) ? true : false
}
function initTodayBurndownObj(a) {
    return{CardEstimateTotal:0, TaskEstimateTotal:0, CardToDoTotal:0, CreationDate:a}
}
function formatDateValue(a) {
    return(a < 10) ? "0" + a : a
}
function calcNumberOfWorkDays(e, a) {
    var b = 0;
    var d = RALLY.Mashup.Utilities.convertIsoDateOnly(e);
    var c = RALLY.Mashup.Utilities.convertIsoDateOnly(a);
    while (d <= c) {
        if (RALLY.Mashup.Utilities.isWorkDay(d)) {
            b = b + 1
        }
        d.setTime(addDaysToDate(d, 1))
    }
    return b
}
function findDateForDay(f, c) {
    var e, b, a, d;
    a = RALLY.Mashup.Utilities.convertIsoDateOnly(f);
    d = Math.round(c);
    if (d <= 0) {
        return a
    }
    e = RALLY.Mashup.Utilities.convertIsoDateOnly(f);
    b = 0;
    while (b < d) {
        if (RALLY.Mashup.Utilities.isWorkDay(e)) {
            b = b + 1;
            if (b === d) {
                return e
            }
        }
        e.setTime(addDaysToDate(e, 1))
    }
    return null
}
function getBeforeState(a) {
    if (a.length > 4 && a[0] !== DEFINED_STATE) {
        return a[0]
    } else {
        return null
    }
}
function getAfterState(a) {
    if (a.length <= 4) {
        return null
    } else {
        if (a.length === 5) {
            if (a[0] === DEFINED_STATE) {
                return a[4]
            } else {
                return null
            }
        } else {
            return a[5]
        }
    }
}
function initDataTuple(b, a) {
    newTuple = [];
    newTuple.CardEstimateTotal = 0;
    newTuple.TaskEstimateTotal = 0;
    newTuple.CardToDoTotal = 0;
    b[a] = newTuple
}
function incrementDataTuple(c, a, b) {
    if (typeof b !== "undefined") {
        c[a]["CardEstimateTotal"] += b.CardEstimateTotal
    }
    if (typeof b !== "undefined") {
        c[a]["TaskEstimateTotal"] += b.TaskEstimateTotal
    }
    if (typeof b !== "undefined") {
        c[a]["CardToDoTotal"] += b.CardToDoTotal
    }
}
function findFirstIndexForDate(d, b) {
    var a;
    for (var c = 0; c < d.length; c++) {
        if (typeof d[c] !== "undefined") {
            a = RALLY.Mashup.Utilities.convertIsoDateOnly(d[c]["CreationDate"]);
            if (a.valueOf() == b.valueOf()) {
                return c
            }
        }
    }
    return -1
}
function addTodayToBurndownData(d, b, a, c) {
    var e = b.getMonth() + 1;
    var f = b.getFullYear() + "-" + formatDateValue(e) + "-" + formatDateValue(b.getDate()) + "T" + formatDateValue(b.getHours()) + ":" + formatDateValue(b.getMinutes()) + ":" + formatDateValue(b.getSeconds()) + ".000Z";
    if (typeof d.definedData === "undefined") {
        d = {definedData:[initTodayBurndownObj(f)], inprogressData:[initTodayBurndownObj(f)], completedData:[initTodayBurndownObj(f)], acceptedData:[initTodayBurndownObj(f)]}
    } else {
        d.definedData.push(initTodayBurndownObj(f));
        d.inprogressData.push(initTodayBurndownObj(f));
        d.completedData.push(initTodayBurndownObj(f));
        d.acceptedData.push(initTodayBurndownObj(f))
    }
    if (a !== null) {
        if (typeof d[a + "Data"] === "undefined") {
            d[a + "Data"] = [initTodayBurndownObj(f)]
        } else {
            d[a + "Data"].push(initTodayBurndownObj(f))
        }
    }
    if (c !== null) {
        if (typeof d[c + "Data"] === "undefined") {
            d[c + "Data"] = [initTodayBurndownObj(f)]
        } else {
            d[c + "Data"].push(initTodayBurndownObj(f))
        }
    }
    return d
}
function sumTodayValues(k, j, m, d) {
    var l = ["HierarchicalRequirement", "Defect", "DefectSuite"];
    var b = ["PlanEstimate", "TaskEstimateTotal", "TaskRemainingTotal"];
    var g = {PlanEstimate:"CardEstimateTotal", TaskEstimateTotal:"TaskEstimateTotal", TaskRemainingTotal:"CardToDoTotal"};
    var e = {Defined:"defined", "In-Progress":"inprogress", Completed:"completed", Accepted:"accepted"};
    var f, a;
    if (m !== null) {
        e[m] = m
    }
    if (d !== null) {
        e[d] = d
    }
    for (var h = 0; h < l.length; h++) {
        f = j[l[h]];
        for (var c = 0; c < f.length; c++) {
            a = e[f[c].ScheduleState];
            if (typeof a !== "undefined") {
                k[a + "Data"][k[a + "Data"].length - 1][g[b[0]]] += f[c][b[0]];
                k[a + "Data"][k[a + "Data"].length - 1][g[b[1]]] += f[c][b[1]];
                k[a + "Data"][k[a + "Data"].length - 1][g[b[2]]] += f[c][b[2]]
            }
        }
    }
    return k
}
function aggregateFlowDataPerDay(v, f, e, s, c) {
    var q = [];
    var p = [];
    var y = [];
    var x = [];
    var m = [];
    var w = [];
    var j = [];
    var t = RALLY.Mashup.Utilities.convertIsoDateOnly(f);
    var d = RALLY.Mashup.Utilities.convertIsoDateOnly(e);
    var h = 0;
    var k, l, g, n;
    var u, b, r, o;
    g = RALLY.Mashup.Utilities.convertIsoDateOnly(v.definedData[0].CreationDate);
    b = calcNumberOfWorkDays(f, v.definedData[0].CreationDate.slice(0, 10));
    if (RALLY.Mashup.Utilities.isWorkDay(g) && g >= t) {
        b = b - 1
    }
    k = new Date(t.getTime());
    h = 0;
    while (k <= g) {
        if (RALLY.Mashup.Utilities.isWorkDay(k)) {
            j[h] = new Date(k.getTime());
            h = h + 1
        }
        k.setTime(addDaysToDate(k, 1))
    }
    k = new Date(g.getTime());
    k.setTime(addDaysToDate(k, -1));
    h = b - 1;
    for (u = 0; u < v.definedData.length; u++) {
        l = RALLY.Mashup.Utilities.convertIsoDateOnly(v.definedData[u].CreationDate);
        if (l > k) {
            k = l;
            if (isValidChartDate(l, t, d)) {
                h = h + 1;
                r = h;
                j[h] = k;
                initDataTuple(q, h);
                initDataTuple(p, h);
                initDataTuple(y, h);
                initDataTuple(x, h);
                initDataTuple(m, h);
                initDataTuple(w, h);
                beforeCnt = 0;
                afterCnt = 0
            }
        }
        if (isValidChartDate(k, t, d)) {
            if (s !== null) {
                o = findFirstIndexForDate(v[s + "Data"], k);
                if (o >= 0) {
                    incrementDataTuple(m, h, v[s + "Data"][o + beforeCnt]);
                    beforeCnt += 1
                }
            }
            j[h] = k;
            incrementDataTuple(q, h, v.definedData[u]);
            incrementDataTuple(p, h, v.inprogressData[u]);
            incrementDataTuple(y, h, v.completedData[u]);
            incrementDataTuple(x, h, v.acceptedData[u]);
            if (c !== null) {
                o = findFirstIndexForDate(v[c + "Data"], k);
                if (o >= 0) {
                    incrementDataTuple(w, h, v[c + "Data"][o + afterCnt]);
                    afterCnt += 1
                }
            }
        }
    }
    n = j[r];
    k = new Date(n.getTime());
    k.setTime(addDaysToDate(k, 1));
    h = r + 1;
    while (k <= d) {
        if (RALLY.Mashup.Utilities.isWorkDay(k)) {
            j[h] = new Date(k.getTime());
            h = h + 1
        }
        k.setTime(addDaysToDate(k, 1))
    }
    var a = {firstDataDay:b, lastDataDay:r, dates:j, definedPerDay:q, inprogressPerDay:p, completedPerDay:y, acceptedPerDay:x};
    if (s !== null) {
        a[s + "PerDay"] = m
    }
    if (c !== null) {
        a[c + "PerDay"] = w
    }
    return a
}
;
/*
 Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved.
 SuperCustomizableChart.js
 */
var RALLY = RALLY || {};
RALLY.Mashup = RALLY.Mashup || {};
RALLY.Mashup.SuperCustomizableChart = function (g, r, E, h, f, V, B, e, s, ah, P) {
    var y = "Defined";
    var z = "In-Progress";
    var J = "Completed";
    var O = "Accepted";
    var w = 3;
    var M = this;
    var F = {};
    var j;
    var ab, af, ae, ac, Z, ad, L;
    var N = {ChartType:"stacked-bar", Units:"story", BeforeStateName:null, AfterStateName:null, BeforeVisible:false, DefinedVisible:true, InProgressVisible:true, CompletedVisible:true, AcceptedVisible:true, AfterVisible:false, BeforeColor:"#EF3F35", DefinedColor:"#E57E3A", InProgressColor:"#5C9ACB", CompletedColor:"#B2E3B6", AcceptedColor:"#6AB17D", AfterColor:"#3A874F", BeforeTrend:false, DefinedTrend:false, InProgressTrend:false, CompletedTrend:false, AcceptedTrend:false, AfterTrend:false, BurndownIdealVisible:false, BurndownIdealColor:"#BBBBBB", BurnupIdealVisible:false, BurnupIdealColor:"#BBBBBB", TableVisible:false, LeftAxisLabelVisible:true, BottomAxisLabelVisible:true, RightAxisLabelVisible:true, LeftAxisVisible:true, BottomAxisVisible:true, RightAxisVisible:true, scopeUp:false, scopeDown:true};
    var ai = [];

    function K() {
        if (typeof P !== "undefined") {
            P()
        }
    }

    function ak(al) {
        if (typeof N.scopeUp !== "undefined") {
            al.projectScopeUp = N.scopeUp
        }
        if (typeof N.scopeDown !== "undefined") {
            al.projectScopeDown = N.scopeDown
        }
    }

    function m(am) {
        for (var al in am) {
            if (am.hasOwnProperty(al)) {
                N[al] = am[al]
            }
        }
    }

    function b() {
        if (V === RALLY.Mashup.ITERATION) {
            return"StartDate"
        } else {
            return"ReleaseStartDate"
        }
    }

    function U() {
        if (V === RALLY.Mashup.ITERATION) {
            return"EndDate"
        } else {
            return"ReleaseDate"
        }
    }

    function T(ao, an) {
        var al = (V === RALLY.Mashup.ITERATION) ? "iterationCumulativeFlowData" : "releaseCumulativeFlowData";
        var am, ap;
        if (an === null || an.length === 0) {
            am = '( CardState = "' + ao + '" )'
        } else {
            am = "(" + an + ' AND ( CardState = "' + ao + '" ))'
        }
        ap = {key:"FlowData", type:al, fetch:"CreationDate,CardEstimateTotal,TaskEstimateTotal,CardToDoTotal", query:am, order:"CreationDate", project:null};
        ak(ap);
        return ap
    }

    function X(al) {
        return(al.getMonth() + 1) + "/" + al.getDate()
    }

    function A(aq, an, al, ao, ap) {
        var ar = [];
        for (var am = al; am <= ao; am++) {
            ar.push([am, an[am][ap], X(aq[am])])
        }
        return ar
    }

    function t(ar, aq, al, am, ap) {
        if (typeof ap === "undefined" || ap === null) {
            ap = "left"
        }
        var an = new EJSC.BarSeries(new EJSC.ArrayDataHandler(aq), {y_axis:ap, padding:{x_axis_min:w, x_axis_max:w, y_axis_min:w, y_axis_max:w}});
        an.title = ar;
        an.color = al;
        an.opacity = 100;
        an.lineWidth = 1;
        j.addSeries(an);
        if (am && aq.length > 1) {
            var ao = new EJSC.TrendSeries(an, "linear");
            ao.lineWidth = 1;
            ao.color = an.color;
            ao.opacity = 100;
            j.addSeries(ao)
        }
        return an
    }

    function d(am, ao, an) {
        var al;
        if (N[am + "Visible"]) {
            if (N.ChartType === "burndown" && am === "BurnupIdeal") {
                al = new EJSC.LineSeries(new EJSC.ArrayDataHandler(an), {y_axis:"right"})
            } else {
                al = new EJSC.LineSeries(new EJSC.ArrayDataHandler(an))
            }
            al.title = ao;
            al.color = N[am + "Color"];
            al.lineWidth = 3;
            al.opacity = 100;
            j.addSeries(al);
            return al
        } else {
            return null
        }
    }

    function S(aq, ap, al, am) {
        var an = new EJSC.LineSeries(new EJSC.ArrayDataHandler(ap));
        an.title = aq;
        an.color = al;
        an.lineWidth = 3;
        an.opacity = 100;
        j.addSeries(an);
        if (am && ap.length > 1) {
            var ao = new EJSC.TrendSeries(an, "linear");
            ao.lineWidth = 1;
            ao.color = an.color;
            ao.opacity = 100;
            j.addSeries(ao)
        }
        return an
    }

    function D(ao, an, al) {
        var am = new EJSC.AreaSeries(new EJSC.ArrayDataHandler(an));
        am.title = ao;
        am.color = al;
        am.lineWidth = 2;
        am.opacity = 100;
        j.addSeries(am);
        return am
    }

    function I(al, ar, aq, am, an) {
        var ao = new EJSC.BarSeries(new EJSC.ArrayDataHandler(aq), {groupedBars:false});
        ao.title = ar;
        ao.color = am;
        ao.lineWidth = 1;
        ao.opacity = 100;
        al.addSeries(ao);
        if (an && aq.length > 1) {
            var ap = new EJSC.TrendSeries(ao, "linear");
            ap.lineWidth = 1;
            ap.color = ao.color;
            ap.opacity = 100;
            j.addSeries(ap)
        }
        return ao
    }

    function C(aA, aq, am, an, ao, au) {
        var ay = [];
        var ax = [];
        var al = [];
        var aw = [];
        var az = [];
        var av = 0;
        var at;
        var ar;
        ay[0] = Array.init(aq, 0);
        if (N.BeforeStateName !== null && N.BeforeVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], aA);
            ax[av] = N.BeforeStateName;
            al[av] = N.BeforeColor;
            aw[av] = N.BeforeTrend
        }
        if (N.DefinedVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], aq);
            ax[av] = "Defined";
            al[av] = N.DefinedColor;
            aw[av] = N.DefinedTrend
        }
        if (N.InProgressVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], am);
            ax[av] = "In-Progress";
            al[av] = N.InProgressColor;
            aw[av] = N.InProgressTrend
        }
        if (N.CompletedVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], an);
            ax[av] = "Completed";
            al[av] = N.CompletedColor;
            aw[av] = N.CompletedTrend
        }
        if (N.AcceptedVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], ao);
            ax[av] = "Accepted";
            al[av] = N.AcceptedColor;
            aw[av] = N.AcceptedTrend
        }
        if (N.AfterStateName !== null && N.AfterVisible) {
            av = av + 1;
            ay[av] = addArray(ay[av - 1], au);
            ax[av] = N.AfterStateName;
            al[av] = N.AfterColor;
            aw[av] = N.AfterTrend
        }
        for (ar = av; ar > 0; ar--) {
            at = D(ax[ar], ay[ar], al[ar]);
            az[ar] = at
        }
        for (ar = av; ar > 0; ar--) {
            if (aw[ar] && ay[ar].length > 1) {
                var ap = new EJSC.TrendSeries(az[ar], "linear");
                ap.lineWidth = 1;
                ap.color = az[ar].color;
                ap.opacity = 100;
                j.addSeries(ap)
            }
        }
        return ay
    }

    function R(ao, am, aq, al, an, ap) {
        L = j.addSeries(new EJSC.StackedBarSeries({intervalOffset:0.7, padding:{x_axis_min:w, x_axis_max:w, y_axis_min:w, y_axis_max:w}}));
        if (N.AfterStateName !== null && N.AfterVisible) {
            ad = I(L, N.AfterStateName, ap, N.AfterColor, N.AfterTrend)
        }
        if (N.AcceptedVisible) {
            ac = I(L, O, an, N.AcceptedColor, N.AcceptedTrend)
        }
        if (N.CompletedVisible) {
            ae = I(L, J, al, N.CompletedColor, N.CompletedTrend)
        }
        if (N.InProgressVisible) {
            af = I(L, z, aq, N.InProgressColor, N.InProgressTrend)
        }
        if (N.DefinedVisible) {
            ab = I(L, y, am, N.DefinedColor, N.DefinedTrend)
        }
        if (N.BeforeStateName !== null && N.BeforeVisible) {
            Z = I(L, N.BeforeStateName, ao, N.BeforeColor, N.BeforeTrend)
        }
    }

    function W(ao, am, aq, al, an, ap) {
        L = j.addSeries(new EJSC.StackedBarSeries({intervalOffset:0.7, padding:{x_axis_min:w, x_axis_max:w, y_axis_min:w, y_axis_max:w}}));
        if (N.BeforeStateName !== null && N.BeforeVisible) {
            Z = I(L, N.BeforeStateName, ao, N.BeforeColor, N.BeforeTrend)
        }
        if (N.DefinedVisible) {
            ab = I(L, y, am, N.DefinedColor, N.DefinedTrend)
        }
        if (N.InProgressVisible) {
            af = I(L, z, aq, N.InProgressColor, N.InProgressTrend)
        }
        if (N.CompletedVisible) {
            ae = I(L, J, al, N.CompletedColor, N.CompletedTrend)
        }
        if (N.AcceptedVisible) {
            ac = t(O, an, N.AcceptedColor, N.AcceptedTrend, "right")
        }
        if (N.AfterStateName !== null && N.AfterVisible) {
            ad = t(N.AfterStateName, ap, N.AfterColor, N.AfterTrend, "right")
        }
    }

    function x(ao, am, aq, al, an, ap) {
        if (N.BeforeStateName !== null && N.BeforeVisible) {
            Z = t(N.BeforeStateName, ao, N.BeforeColor, N.BeforeTrend)
        }
        if (N.DefinedVisible) {
            ab = t(y, am, N.DefinedColor, N.DefinedTrend)
        }
        if (N.InProgressVisible) {
            af = t(z, aq, N.InProgressColor, N.InProgressTrend)
        }
        if (N.CompletedVisible) {
            ae = t(J, al, N.CompletedColor, N.CompletedTrend)
        }
        if (N.AcceptedVisible) {
            ac = t(O, an, N.AcceptedColor, N.AcceptedTrend)
        }
        if (N.AfterStateName !== null && N.AfterVisible) {
            ad = t(N.AfterStateName, ap, N.AfterColor, N.AfterTrend)
        }
    }

    function H(ao, am, aq, al, an, ap) {
        if (N.BeforeStateName !== null && N.BeforeVisible) {
            Z = S(N.BeforeStateName, ao, N.BeforeColor, N.BeforeTrend)
        }
        if (N.DefinedVisible) {
            ab = S(y, am, N.DefinedColor, N.DefinedTrend)
        }
        if (N.InProgressVisible) {
            af = S(z, aq, N.InProgressColor, N.InProgressTrend)
        }
        if (N.CompletedVisible) {
            ae = S(J, al, N.CompletedColor, N.CompletedTrend)
        }
        if (N.AcceptedVisible) {
            ac = S(O, an, N.AcceptedColor, N.AcceptedTrend)
        }
        if (N.AfterStateName !== null && N.AfterVisible) {
            ad = S(N.AfterStateName, ap, N.AfterColor, N.AfterTrend)
        }
    }

    function aa(al) {
        var an = al.toUTCString().slice(5);
        var am = an.toString().split(/ /);
        return am[1] + " " + am[0] + ", " + am[2]
    }

    function Q(al) {
        return Math.round(al * 100) / 100
    }

    function p(am) {
        var an = new google.visualization.DataTable();
        var au, al, ap;
        var ar, aq, ao;
        ar = aj();
        if (N.ChartType === "burndown") {
            aq = "CardEstimateTotal"
        } else {
            aq = ar
        }
        an.addColumn("string", "Date");
        if (N.BeforeStateName !== null) {
            an.addColumn("number", N.BeforeStateName)
        }
        an.addColumn("number", y);
        an.addColumn("number", z);
        an.addColumn("number", J);
        an.addColumn("number", O);
        if (N.AfterStateName !== null) {
            an.addColumn("number", N.AfterStateName)
        }
        ap = am.lastDataDay - am.firstDataDay + 1;
        an.addRows(ap);
        au = 0;
        for (ao = am.firstDataDay; ao <= am.lastDataDay; ao++) {
            al = 0;
            an.setCell(au, al++, aa(am.dates[ao]));
            if (N.BeforeStateName !== null) {
                an.setCell(au, al++, Q(am[N.BeforeStateName + "PerDay"][ao][ar]))
            }
            an.setCell(au, al++, Q(am.definedPerDay[ao][ar]));
            an.setCell(au, al++, Q(am.inprogressPerDay[ao][ar]));
            an.setCell(au, al++, Q(am.completedPerDay[ao][ar]));
            an.setCell(au, al++, Q(am.acceptedPerDay[ao][aq]));
            if (N.AfterStateName !== null) {
                an.setCell(au, al++, Q(am[N.AfterStateName + "PerDay"][ao][aq]))
            }
            au = au + 1
        }
        document.getElementById(s).style.visibility = "visible";
        var at = new google.visualization.Table(document.getElementById(s));
        at.draw(an, {allowHtml:true, showRowNumber:false})
    }

    function aj() {
        if (N.Units === "story") {
            return"CardEstimateTotal"
        } else {
            if (N.Units === "task") {
                return"TaskEstimateTotal"
            } else {
                return"CardToDoTotal"
            }
        }
    }

    function n(an, am, ao) {
        var al;
        al = an.definedPerDay[ao][am] + an.inprogressPerDay[ao][am] + an.completedPerDay[ao][am] + an.acceptedPerDay[ao][am];
        if (N.BeforeStateName !== null) {
            al = al + an[N.BeforeStateName + "PerDay"][ao][am]
        }
        if (N.AfterStateName !== null) {
            al = al + an[N.AfterStateName + "PerDay"][ao][am]
        }
        return al
    }

    function l(am, an) {
        var al;
        al = am.acceptedPerDay[an]["CardEstimateTotal"];
        if (N.AfterStateName !== null) {
            al = al + am[N.AfterStateName + "PerDay"][an]["CardEstimateTotal"]
        }
        return al
    }

    function q(an, ao) {
        var al, am;
        am = aj();
        al = an.definedPerDay[ao][am] + an.inprogressPerDay[ao][am] + an.completedPerDay[ao][am];
        if (N.BeforeStateName !== null) {
            al = al + an[N.BeforeStateName + "PerDay"][ao][am]
        }
        return al
    }

    function ag(am) {
        var al;
        if (N.ChartType === "burndown") {
            al = "TaskEstimateTotal"
        } else {
            al = aj()
        }
        return n(am, al, am.firstDataDay)
    }

    function k(am) {
        var al;
        if (N.ChartType === "burndown") {
            al = "CardEstimateTotal"
        } else {
            al = aj()
        }
        return n(am, al, am.firstDataDay)
    }

    function c(ao, an) {
        var ap = 0, am = 0;
        for (var al = ao.firstDataDay; al <= ao.lastDataDay; al++) {
            if (N.ChartType === "burndown") {
                ap = Math.max(ap, q(ao, al));
                am = Math.max(am, l(ao, al))
            } else {
                ap = Math.max(ap, n(ao, an, al));
                am = ap
            }
        }
        if (ap < 0.01) {
            ap = 1
        }
        if (am < 0.01) {
            am = 1
        }
        return[ap, am]
    }

    function Y(an) {
        var aH = null, aI = null;
        var aD, aw, ay, am;
        var at, aF;
        var aq, ap, az, ax;
        var ar = an.dates.length - 1;
        var av, aC, aG, al;
        var ao = 300;
        av = aj();
        if (N.ChartType === "burndown") {
            aC = "CardEstimateTotal"
        } else {
            aC = av
        }
        aD = A(an.dates, an.definedPerDay, an.firstDataDay, an.lastDataDay, av);
        aw = A(an.dates, an.inprogressPerDay, an.firstDataDay, an.lastDataDay, av);
        ay = A(an.dates, an.completedPerDay, an.firstDataDay, an.lastDataDay, av);
        am = A(an.dates, an.acceptedPerDay, an.firstDataDay, an.lastDataDay, aC);
        if (N.BeforeStateName !== null) {
            aH = A(an.dates, an[N.BeforeStateName + "PerDay"], an.firstDataDay, an.lastDataDay, av)
        }
        if (N.AfterStateName !== null) {
            aI = A(an.dates, an[N.AfterStateName + "PerDay"], an.firstDataDay, an.lastDataDay, aC)
        }
        at = ag(an);
        aF = k(an);
        aG = c(an, av);
        var aE = X(an.dates[an.dates.length - 1]);
        var aB = [
            [0, at, an.dates[0]],
            [ar, 0, aE]
        ];
        var aA = [
            [0, 0, an.dates[0]],
            [ar, aF, aE]
        ];
        az = "Ideal Burndown To Do";
        ax = "Ideal Burn-up Accepted";
        document.getElementById(e).style.visibility = "visible";
        var au = function () {
            EJSC.Formatter.__extendTo(this);
            this.format = function (aJ) {
                if (Math.round(aJ) !== aJ) {
                    return""
                }
                if (aJ >= 0 && aJ < an.dates.length) {
                    return X(an.dates[aJ])
                } else {
                    return X(findDateForDay(h, aJ))
                }
            }
        };
        if (typeof j !== "undefined") {
            j.remove()
        }
        j = new EJSC.Chart(e, {show_legend:false, allow_zoom:false, show_titlebar:false, axis_bottom:{caption:"", caption_class:"AxisCaption", label_class:"AxisTickLabel", size:0, min_extreme:0, max_extreme:ar, extremes_ticks:true, major_ticks:{opacity:100, min_interval:3, show:true, thickness:1}, visible:N.BottomAxisVisible}, axis_left:{caption:"", caption_class:"AxisCaption", label_class:"AxisTickLabel", size:0, min_extreme:0, formatter:new EJSC.NumberFormatter({variable_decimals:1}), visible:N.LeftAxisVisible}, axis_right:{caption:"", caption_class:"AxisCaption", label_class:"AxisTickLabel", size:0, min_extreme:0, grid:{show:false}, formatter:new EJSC.NumberFormatter({variable_decimals:1}), visible:N.RightAxisVisible}});
        if (N.ChartType === "stacked-bar" || N.ChartType === "grouped-bar" || N.ChartType === "burndown") {
            j.axis_bottom.setExtremes(-0.35, ar + 0.35)
        }
        j.axis_left.setExtremes(0, Math.round(Math.max(at, aG[0])));
        if (N.ChartType === "burndown") {
            j.axis_right.setExtremes(0, Math.round(Math.max(aF, aG[1])))
        }
        al = parseInt(document.getElementById(e).style.width, 10);
        if (isNaN(al)) {
            al = 0
        }
        if (N.BottomAxisLabelVisible) {
            j.axis_bottom.caption = "Date";
            if (al > ao) {
            }
        }
        if (N.LeftAxisLabelVisible) {
            if (al > ao) {
                j.axis_left.size = Math.round(al * 0.06)
            }
            if (N.Units === "story") {
                j.axis_left.caption = "Plan Estimates"
            } else {
                if (N.Units === "task") {
                    j.axis_left.caption = "Task Estimates"
                } else {
                    j.axis_left.caption = "Task To Do"
                }
            }
        }
        if (N.ChartType === "burndown") {
            if (al > ao) {
                j.axis_right.size = Math.round(al * 0.07)
            }
            if (N.RightAxisLabelVisible) {
                j.axis_right.caption = "Plan Estimate"
            }
        }
        j.axis_bottom.formatter = new au();
        j.onShowHint = function (aJ, aK, aL, aN, aM) {
            if (aK.title.indexOf("Trend") >= 0) {
                return"[series_title]<br/>Value: " + Math.round(aJ.y * 100) / 100
            } else {
                if (aK.title.indexOf("Ideal") >= 0) {
                    return"[series_title]<br/>Date: [x]<br/>Value: " + Math.round(aJ.y * 100) / 100
                } else {
                    return"[series_title]<br/>Date: [label]<br/>" + v(aK.title) + ": " + Math.round(aJ.y * 100) / 100
                }
            }
        };
        if (N.ChartType === "stacked-bar") {
            R(aH, aD, aw, ay, am, aI)
        } else {
            if (N.ChartType === "grouped-bar") {
                x(aH, aD, aw, ay, am, aI)
            } else {
                if (N.ChartType === "area") {
                    C(aH, aD, aw, ay, am, aI)
                } else {
                    if (N.ChartType === "burndown") {
                        W(aH, aD, aw, ay, am, aI)
                    } else {
                        H(aH, aD, aw, ay, am, aI)
                    }
                }
            }
        }
        aq = d("BurndownIdeal", az, aB);
        ap = d("BurnupIdeal", ax, aA);
        if (N.TableVisible && s !== null) {
            p(an)
        }
    }

    function v(al) {
        if (N.ChartType === "burndown" && al.indexOf("Accepted") >= 0) {
            if (V === RALLY.Mashup.ITERATION) {
                return ai.IterationEstimateUnitName
            } else {
                return ai.ReleaseEstimateUnitName
            }
        } else {
            if (N.Units === "story") {
                if (V === RALLY.Mashup.ITERATION) {
                    return ai.IterationEstimateUnitName
                } else {
                    return ai.ReleaseEstimateUnitName
                }
            } else {
                return ai.TaskUnitName
            }
        }
    }

    function G(al) {
        function ap() {
            if (V === RALLY.Mashup.ITERATION) {
                return"Iteration.StartDate"
            } else {
                return"Release.ReleaseStartDate"
            }
        }

        function an() {
            if (V === RALLY.Mashup.ITERATION) {
                return"Iteration.EndDate"
            } else {
                return"Release.ReleaseDate"
            }
        }

        function ao() {
            if (V === RALLY.Mashup.ITERATION) {
                return"Iteration.Name"
            } else {
                return"Release.Name"
            }
        }

        var am = {key:al, type:al, query:"((( " + ap() + " = " + h + ") AND (" + an() + " = " + f + ")) AND (" + ao() + ' = "' + E + '"))', fetch:"PlanEstimate,TaskEstimateTotal,TaskRemainingTotal,ScheduleState"};
        if (ah !== null) {
            am.project = "/project/" + ah
        }
        ak(am);
        return am
    }

    function a(aq, an, am, ao) {
        var al = [];
        aq = addTodayToBurndownData(aq, an, am, ao);
        var ap = function (ar) {
            aq = sumTodayValues(aq, ar, am, ao);
            i()
        };
        al[0] = G("HierarchicalRequirement");
        al[1] = G("Defect");
        al[2] = G("DefectSuite");
        BATCH_TOOLKIT.findAll(al, ap)
    }

    function i() {
        var am;
        var al = new Date();
        if (s !== null) {
            document.getElementById(s).style.visibility = "hidden"
        }
        if (typeof F.definedData === "undefined" || (F.definedData.length + F.inprogressData.length + F.completedData.length + F.acceptedData.length) === 0 || al < RALLY.Mashup.Utilities.convertIsoDateOnly(h)) {
            document.getElementById(e).style.visibility = "visible";
            document.getElementById(e).innerHTML = "No Data";
            K()
        } else {
            am = aggregateFlowDataPerDay(F, h, f, N.BeforeStateName, N.AfterStateName);
            Y(am);
            K()
        }
    }

    function o(am) {
        var az = [], at = [], aq = {}, ax;
        if (r !== null) {
            ax = r.split(",");
            for (var ar = 0; ar < ax.length; ar++) {
                aq = {};
                aq.ObjectID = ax[ar];
                at[ar] = aq
            }
        } else {
            at = am.timeboxOids
        }
        if (at.length === 0) {
            return
        }
        var aw = (V === RALLY.Mashup.ITERATION) ? "IterationObjectID" : "ReleaseObjectID";
        if (N.BeforeStateName !== null) {
            var av = T(N.BeforeStateName, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
            g.findAll(av, ay)
        } else {
            ay(az)
        }
        ai = am.estimateUnit[0];
        function ay(aA) {
            if (N.BeforeStateName !== null) {
                F[N.BeforeStateName + "Data"] = aA.FlowData
            }
            var aB = T(y, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
            g.findAll(aB, ap)
        }

        function ap(aA) {
            F.definedData = aA.FlowData;
            av = T(z, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
            g.findAll(av, al)
        }

        function al(aA) {
            F.inprogressData = aA.FlowData;
            av = T(J, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
            g.findAll(av, au)
        }

        function au(aA) {
            F.completedData = aA.FlowData;
            av = T(O, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
            g.findAll(av, ao)
        }

        function ao(aA) {
            F.acceptedData = aA.FlowData;
            if (N.AfterStateName !== null) {
                var aB = T(N.AfterStateName, RALLY.Mashup.Utilities.buildOrQueryString(at, aw, "ObjectID"));
                g.findAll(aB, an)
            } else {
                an(az)
            }
        }

        function an(aC) {
            if (N.AfterStateName !== null) {
                F[N.AfterStateName + "Data"] = aC.FlowData
            }
            var aA = RALLY.Mashup.Utilities.convertIsoDateOnly(h);
            var aD = RALLY.Mashup.Utilities.convertIsoDateOnly(f);
            aD.setHours(23, 59, 0, 0);
            var aB = new Date();
            if (isValidChartDate(aB, aA, aD) && V !== RALLY.Mashup.Program) {
                a(F, aB, N.BeforeStateName, N.AfterStateName)
            } else {
                i()
            }
        }
    }

    function u() {
        var an = b();
        var ao = U();
        var am = [];
        var al = "((( " + an + " = " + h + ") AND (" + ao + " = " + f + ')) AND (Name = "' + E + '"))';
        am[0] = {key:"timeboxOids", type:V, fetch:"ObjectID,Name,project," + an + "," + ao, query:al, order:ao + " desc"};
        ak(am[0]);
        am[1] = {key:"estimateUnit", type:"WorkspaceConfiguration", fetch:"TaskUnitName,IterationEstimateUnitName,ReleaseEstimateUnitName"};
        ak(am[1]);
        if (ah !== null) {
            am[0].project = "/project/" + ah
        }
        g.findAll(am, o)
    }

    this.display = function () {
        u()
    };
    this.redisplay = function (al) {
        m(al);
        i()
    };
    if (B !== null) {
        m(B)
    }
    return M
};
/*
 Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved.
 DashboardUtilities.js
 */
function convertMillisecondsToDays(a) {
    return a / 86400000
}
function convertDateStringToDateObject(b) {
    b = b.split("T")[0].split("-");
    var a = new Date();
    a.setFullYear(b[0], b[1] - 1, b[2]);
    return a
}
function calcWorkDays(b, f) {
    var e = convertMillisecondsToDays(f - b);
    var a = 0;
    var d = b.getDay();
    var c = f.getDay();
    if ((d > 0) && (d < 6)) {
        a += 6 - d;
        e -= 6 - d
    }
    if (c == 6) {
        a += 5;
        e -= 5
    } else {
        a += c;
        e -= c
    }
    a += Math.floor(e / 7) * 5;
    return a
}
function calculateHealth(b, o, f, a) {
    var h = ["Good", "At Risk", "Critical", "Not Started", "Completed"];
    var c = 0;
    var q = convertDateStringToDateObject(b.slice(0, 10));
    var p = convertDateStringToDateObject(o.slice(0, 10));
    var g = new Date();
    if (q > g) {
        return h[3]
    } else {
        if (g > p) {
            return h[4]
        }
    }
    var m = 0;
    var l = 0;
    for (var n = 0; n < f.length; n++) {
        if (f[n] === "Accepted") {
            m += Math.round(a[n])
        }
        if ((n >= 1) && (f[n - 1] === "Accepted")) {
            m += Math.round(a[n])
        }
        l += Math.round(a[n])
    }
    var r = Math.round((m / l) * 100);
    var j = calcWorkDays(q, p);
    var e = calcWorkDays(q, g) - 1;
    var s = calcWorkDays(g, p);
    var k = Math.round((e / j) * 100);
    var d = Math.round((r / k) * 100);
    if (d >= 70 && d < 90) {
        c = 1
    } else {
        if (d < 70) {
            c = 2
        }
    }
    return[h[c], s, j, r]
}
function removeEmptyValues(a) {
    var b = [];
    for (var c = 0; c < a.length; c++) {
        if (a[c]) {
            b.push(a[c])
        }
    }
    return b
}
;
/*
 Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved.
 Dashboard.js
 */
dojo.addOnLoad(initPage);

var BATCH_TOOLKIT, DROPDOWN, DASHBOARD;
var legendPane = null;

function checkForScopeUp(scopeUp) {
    var warningDiv = document.getElementById('warning');
    if (scopeUp === '__PROJECT_' + 'SCOPING_UP__' || typeof scopeUp === 'undefined') {
        warningDiv.style.visibility = 'hidden';
        return;
    } else {
        if (scopeUp === 'true') {
            warningDiv.style.visibility = 'visible';
            warningDiv.innerHTML = 'You have scope up ' +
                    '(show items from parent projects) turned on, ' +
                    'which produces unexpected results.  Click the ' +
                    'help icon for more information.';
        } else {
            warningDiv.style.visibility = 'hidden';
        }
    }
}

//TODO: Figure out a clever way to make a function that can return the value of a hangman 
//  variable or a default if it has not been interpolated
function getAvailableWidth() {
    var browserWidth = document.body.clientWidth || window.innerWidth;
    if ('__width__' !== '__w' + 'idth__') {
        return '__width__';
    } else {
        return browserWidth;
    }
}

function getWidgetOid() {
    if ('__widgetOid__' !== '__widget' + 'Oid__') {
        return '__widgetOid__';
    } else {
        return 'mashup';
    }
}

function drawLegend(allowedValues, config) {
    var titleString = '';

    if (config.showScheduledWorkChart === true) {
        titleString += '<div style="width: ' + config.chartWidth +
                'px; float: left; text-align: center;">Scheduled Work</div>';
    }
    if (config.showTestCaseChart === true) {
        titleString += '<div style="width: ' + config.chartWidth +
                'px; float: left; text-align: center;">Test Cases</div>';
    }
    if (config.showDefectChart === true) {
        titleString += '<div style="width: ' + config.chartWidth +
                'px; float: left; text-align: center;">Defects</div>';
    }
    if (config.showBurndownChart === true) {
        titleString += '<div style="width: ' + config.chartWidth +
                'px; float: left; text-align: center;">Burndown</div>';
    }

    if (legendPane === null) {
        legendPane = new dijit.TitlePane({title:titleString, open:false}, dojo.byId("legendDiv"));
    }

    var legendConfig = {
        width:config.chartWidth,
        height:100,
        legendClass:'dashboard-legend',
        id:'myLegend',
        boxClass:'dashboard-boxstyle',
        labelClass:'dashboard-labelstyle'
    };

    if (config.showScheduledWorkChart === true) {
        var labels1 = allowedValues.scheduleStates;
        var colors1 = RALLY.Mashup.Pie.getColors(allowedValues.scheduleStates);
        var legend1 = new RALLY.Mashup.Legend(legendConfig, colors1, labels1);
        legend1.replace("placeholder1");
    } else {
        document.getElementById('placeholder1').style.display = 'none';
    }

    if (config.showTestCaseChart === true) {
        var labels2 = allowedValues.testVerdicts;
        labels2.push("No Result");
        var colors2 = RALLY.Mashup.Pie.getColors(allowedValues.testVerdicts);
        var legend2 = new RALLY.Mashup.Legend(legendConfig, colors2, labels2);
        legend2.replace("placeholder2");
    } else {
        document.getElementById('placeholder2').style.display = 'none';
    }

    if (config.showDefectChart === true) {
        var labels3 = allowedValues.defectStates;
        var colors3 = RALLY.Mashup.Pie.getColors(allowedValues.defectStates);
        var legend3 = new RALLY.Mashup.Legend(legendConfig, colors3, labels3);
        legend3.replace("placeholder3");
    } else {
        document.getElementById('placeholder3').style.display = 'none';
    }
}

function showDashboard(results) {
    var maxWidthForTwoColumns = 700;
    var allowedValues = {};

    allowedValues.scheduleStates = removeEmptyValues(results.scheduleState);
    allowedValues.testVerdicts = removeEmptyValues(results.testResult);
    allowedValues.defectStates = removeEmptyValues(results.defectState);

    function dashboardCallback(states, values) {
    }

    function calcChartWidth(chartWidth, pixelBuffer, numCols) {
        return (chartWidth - pixelBuffer) / numCols;
    }

    var config = {
        showBurndownChart:true,
        showTestCaseChart:true,
        showDefectChart:true,
        showScheduledWorkChart:true,
        showTitle:true,
        browserWidth:CHART_WIDTH * 0.90,
        chartWidth:calcChartWidth(CHART_WIDTH * 0.9, 200, 4),
        LeftAxisVisible:true,
        RightAxisVisible:true,
        BottomAxisVisible:true,
        mashupType:MASHUP_TYPE,
        timeboxType:TIMEBOX_TYPE,
        specialVersion:SPECIAL_VERSION,
        burndownUnits:BURNDOWN_UNITS,
        allowedValues:allowedValues,
        projectOidsInScope:PROJECT_OIDS_IN_SCOPE,
        workspaceOid:WORKSPACE_OID
    };

    if (WIDGET_MODE) {
        config.showTitle = false;
        config.LeftAxisVisible = false;
        config.RightAxisVisible = false;
        config.BottomAxisVisible = false;
        if (CHART_WIDTH < maxWidthForTwoColumns) {
            config.showDefectChart = false;
            config.showTestCaseChart = false;
            config.showTitle = false;
            config.chartWidth = calcChartWidth(CHART_WIDTH * 0.9, 150, 2);
        }
    }

    if (MASHUP_TYPE === RALLY.Mashup.PROGRAM) {
        config.programName = DROPDOWN.getSelectedName();
        config.programStart = DROPDOWN.getSelectedStart();
        config.programEnd = DROPDOWN.getSelectedEnd();
        config.releaseOids = DROPDOWN.getSelectedOids();
        config.dropdown = DROPDOWN;
    } else if (MASHUP_TYPE === RALLY.Mashup.ITERATION || MASHUP_TYPE === RALLY.Mashup.RELEASE) {
        config.projectOid = PROJECT_OID;
        config.timeboxName = DROPDOWN.getSelectedName();
        config.timeboxStart = DROPDOWN.getSelectedStart();
        config.timeboxEnd = DROPDOWN.getSelectedEnd();
        config.selectedOids = DROPDOWN.getSelectedOids();
        config.levels = 1;
    } else if (MASHUP_TYPE === RALLY.Mashup.CURRENT) {
        config.projectOid = PROJECT_OID;
        config.LeftAxisVisible = false;
        config.RightAxisVisible = false;
        config.BottomAxisVisible = false;
        if (CHART_WIDTH < maxWidthForTwoColumns) {
            config.chartWidth = calcChartWidth(CHART_WIDTH * 0.9, 150, 2);
        } else {
            config.chartWidth = calcChartWidth(CHART_WIDTH * 0.7, 200, 4);
        }
    }

    if (typeof DASHBOARD === "undefined") {
        if (MASHUP_TYPE === RALLY.Mashup.PROGRAM) {
            RALLY.Mashup.Utilities.showHelpIcon('140');
            DASHBOARD = new RALLY.Mashup.ProgramHealth(BATCH_TOOLKIT, dashboardCallback);
        } else if (MASHUP_TYPE === RALLY.Mashup.RELEASE || MASHUP_TYPE === RALLY.Mashup.ITERATION) {
            RALLY.Mashup.Utilities.showHelpIcon('163');
            DASHBOARD = new RALLY.Mashup.TimeboxHealth(BATCH_TOOLKIT, dashboardCallback);
        } else if (MASHUP_TYPE === RALLY.Mashup.CURRENT) {
            DASHBOARD = new RALLY.Mashup.CurrentHealth(BATCH_TOOLKIT, dashboardCallback);
        }
    }

    document.getElementById('legendDiv').style.display = 'block';
    drawLegend(allowedValues, config);
    document.getElementById('legendDiv').style.width = config.browserWidth - 30 + 'px';

    DASHBOARD.display(config);
}

function runAllowedValuesQuery() {
    var queryArray = [];

    queryArray[0] = {
        key:'scheduleState',
        type:'Hierarchical Requirement',
        attribute:'Schedule State',
        workspace:'/workspace/' + WORKSPACE_OID
    };
    queryArray[1] = {
        key:'testResult',
        type:'Test Case',
        attribute:'Last Verdict',
        workspace:'/workspace/' + WORKSPACE_OID
    };
    queryArray[2] = {
        key:'defectState',
        type:'Defect',
        attribute:'State',
        workspace:'/workspace/' + WORKSPACE_OID
    };
    try {
        BATCH_TOOLKIT.findAll(queryArray, showDashboard);
    } catch (err) {
        console.error(err);
    }
}

function initPage() {
    var widgetId = getWidgetOid();
    var config = {};

    document.getElementById('legendDiv').style.display = 'none';
    WIDGET_MODE = RALLY.Mashup.Utilities.getDisplayMode('__MODE__') === 'widget' || RALLY.Mashup.Utilities.getDisplayMode('__MODE__') === 'panel';

    CHART_WIDTH = getAvailableWidth();

    if (typeof(PROJECT_OID) !== "undefined") {
        config.project = "/project/" + PROJECT_OID;
    }
    if (typeof(WORKSPACE_OID) !== "undefined") {
        config.workspace = "/workspace/" + WORKSPACE_OID;
    }
    if (typeof(SCOPE_DOWN) !== "undefined") {
        config.projectScopeDown = SCOPE_DOWN;
    }
    if (typeof(SCOPE_UP) !== "undefined") {
        config.projectScopeUp = SCOPE_UP;
    }

    if (WIDGET_MODE) {
        document.getElementById('warning').style.display = 'none';
        document.getElementById('helpAndActions').style.display = 'none';
        document.getElementById('title').style.display = 'none';
    } else {
        checkForScopeUp('__PROJECT_SCOPING_UP__');
        RALLY.Mashup.Utilities.showPrintButton();
    }

    BATCH_TOOLKIT = new RALLY.Mashup.BatchToolkit(WORKSPACE_OID, PROJECT_OID,
            SCOPE_UP, SCOPE_DOWN);

    if (MASHUP_TYPE === RALLY.Mashup.CURRENT) {
        runAllowedValuesQuery();

    } else {
        DROPDOWN = new RALLY.Mashup.Dropdown(BATCH_TOOLKIT, MASHUP_TYPE,
                'timeboxList', 'timeboxLabel', 'mu_dashboard_' + MASHUP_TYPE.toLowerCase() +
                        '_' + widgetId, config);
        DROPDOWN.invoke(runAllowedValuesQuery);
    }

}
/*
 Copyright (c) 2002-2010  Rally Software Development Corp. All rights reserved.
 timebox-health.js
 */
var RALLY = RALLY || {};
RALLY.Mashup = RALLY.Mashup || {};
RALLY.Mashup.TimeboxHealth = function (e, d) {
    var t = 40;
    var y = {};
    var f = this;
    var x = {};

    function v(A) {
        var B = [];
        var z = {Good:"check-icon.gif", "At Risk":"caution-icon.gif", Critical:"error-icon.gif"};
        if (A[0] === "Good" || A[0] === "At Risk" || A[0] === "Critical") {
            B[0] = '&nbsp;<img border="0" align="Absmiddle" src="/slm/mashup/1.15/images/' + z[A[0]] + '" alt="' + A[0] + '"/>&nbsp;' + x.timeboxType + " Health is <b>" + A[0] + "</b>.";
            B[1] = "&nbsp;With " + A[1] + " workdays remaining in a " + A[2] + "-workday " + x.timeboxType.toLowerCase() + ", " + A[3] + "% has been accepted."
        } else {
            B[0] = " - " + x.timeboxType + " is " + A;
            B[1] = ""
        }
        return B
    }

    function c(z, A, G, E, B) {
        var D, F, C;
        D = document.createElement("DIV");
        D.innerHTML = "";
        D.style.marginLeft = G * t + "px";
        D.innerHTML += "&nbsp;" + A;
        D.id = "row" + E + "_header";
        D.className = "dashboard-heading";
        z.appendChild(D);
        F = document.createElement("DIV");
        F.id = "row" + E + "_health";
        F.className = "dashboard-health";
        F.style.marginLeft = G * t + "px";
        z.appendChild(F)
    }

    function a(z, B, C) {
        var A;
        A = document.createElement("DIV");
        A.innerHTML = "";
        A.style.marginLeft = C * t + "px";
        A.id = "row" + B + "_footer";
        A.className = "dashboard-footer";
        z.appendChild(A)
    }

    function w(J, C, A, I) {
        var B, H, K, G;
        var D = x.chartWidth;
        var F = 0;
        var z = document.createElement("DIV");
        z.id = "pie_container_" + I;
        z.className += "dashboard-rowContainer";
        for (var E in x) {
            if (E.match(/show\w+Chart/) !== null && x[E] === true) {
                F += 1
            }
        }
        c(z, C, A, I, F);
        for (G = 0; G < F; G++) {
            B = document.createElement("DIV");
            B.className = "dashboard-chart";
            B.id = "row" + I + "_div" + G;
            B.style.width = D + "px";
            B.style.height = D * 0.6 + "px";
            if (G === 0) {
                B.style.marginLeft = A * t + "px"
            }
            H = document.createElement("DIV");
            H.id = "row" + I + "_div" + G + "_inner";
            H.style.width = D * 0.9 + "px";
            H.style.height = D * 0.55 + "px";
            B.appendChild(H);
            z.appendChild(B)
        }
        a(z, I, A);
        J.appendChild(z)
    }

    function g() {
        RALLY.Mashup.Utilities.hideWait("spinner")
    }

    function s() {
        var z = 0;
        for (var A in x) {
            if (A.match(/show\w+Chart/) !== null && x[A] === true) {
                z += 1
            }
        }
        return z
    }

    function l(H, I, C, J, z, L) {
        var A;

        function E(M) {
            var N;
            for (N = 0; N < M.length; N++) {
                if (M[N] > 0) {
                    return true
                }
            }
            return false
        }

        function B(M, O, Q, P) {
            var R, N, S;
            if (H === "ScheduledWork") {
                S = E(P);
                if (S) {
                    R = calculateHealth(M, O, Q, P);
                    if (R !== null && !isNaN(R[3])) {
                        N = v(R);
                        document.getElementById("row" + J + "_header").innerHTML += N[0];
                        document.getElementById("row" + J + "_health").innerHTML = N[1]
                    } else {
                        if (R === "Completed" || R === "Not Started") {
                            document.getElementById("row" + J + "_header").innerHTML += " - " + x.mashupType + " is " + R
                        }
                    }
                } else {
                    divNum = s();
                    for (i = 0; i < divNum; i++) {
                        document.getElementById("row" + J + "_div" + i).className = "dashboard-hide-chart"
                    }
                    document.getElementById("row" + J + "_health").innerHTML += "&nbsp;No Data"
                }
            }
        }

        var G = x.chartWidth * 0.9 - (z.Level);
        var D = G * 0.5;
        if (x.browserWidth < 600) {
            D = G * 0.8
        }
        var F;
        var K = {allowedValues:x.allowedValues, timeboxName:x.timeboxName, timeboxStart:x.timeboxStart, timeboxEnd:x.timeboxEnd, timeboxType:x.timeboxType, artifactType:H, artifactAttribute:I, chartDiv:C + "_inner", projectOid:z.ObjectID, workspaceOid:x.workspaceOid, pieWidth:G, pieHeight:D};
        F = document.getElementById(C);
        F.setAttribute("class", L);
        F.setAttribute("className", L);
        A = new RALLY.Mashup.Pie(e, K, B);
        A.display()
    }

    function m(C, A) {
        var B;
        var z = {BurndownIdealVisible:true, LeftAxisLabelVisible:false, BottomAxisLabelVisible:false, RightAxisLabelVisible:false, ChartType:"burndown", Units:x.burndownUnits, LeftAxisVisible:x.LeftAxisVisible, RightAxisVisible:x.RightAxisVisible, BottomAxisVisible:x.BottomAxisVisible};
        if (getBeforeState(x.allowedValues.scheduleStates) !== null) {
            z.BeforeStateName = getBeforeState(x.allowedValues.scheduleStates);
            z.BeforeVisible = true
        }
        if (getAfterState(x.allowedValues.scheduleStates) !== null) {
            z.AfterStateName = getAfterState(allowedValues.scheduleStates);
            z.AfterVisible = true
        }
        if (!x.specialVersion) {
            z.CompletedVisible = false
        }
        B = new RALLY.Mashup.SuperCustomizableChart(e, null, x.timeboxName, x.timeboxStart, x.timeboxEnd, x.timeboxType, z, C + "_inner", null, A, g);
        B.display()
    }

    function n(B, A, z) {
        if (x.showBurndownChart) {
            m("row" + A + "_div" + z, B.ObjectID)
        }
    }

    function u(B, A) {
        var z = 0;
        if (x.showScheduledWorkChart) {
            l("ScheduledWork", "ScheduleState", "row" + A + "_div" + z, A, B, "dashboard-FirstChart");
            z += 1
        }
        if (x.showTestCaseChart) {
            l("TestCase", "LastVerdict", "row" + A + "_div" + z, A, B, "dashboard-SecondChart");
            z += 1
        }
        if (x.showDefectChart) {
            l("Defect", "State", "row" + A + "_div" + z, A, B, "dashboard-ThirdChart");
            z += 1
        }
        return z
    }

    function b() {
        var z = document.getElementById("charts");
        while (z.hasChildNodes()) {
            z.removeChild(z.firstChild)
        }
    }

    function o(A) {
        var C, D, B, z;
        b();
        if (x.showTitle) {
            document.getElementById("title").style.display = "";
            k()
        } else {
            document.getElementById("title").style.display = "none"
        }
        C = document.getElementById("charts");
        C.style.width = x.browserWidth - 50 + "px";
        for (B = 0; B < A.length; B++) {
            w(C, A[B].Name, A[B].Level, B)
        }
        for (B = 0; B < A.length; B++) {
            z = u(A[B], B)
        }
        for (B = 0; B < A.length; B++) {
            n(A[B], B, z)
        }
    }

    function p(z) {
        var B = x.projectOid;
        var A = j(B, z);
        o(A)
    }

    function j(B, D) {
        console.log(x);
        var C = [];
        var H;
        var F = 0;
        var z = x.levels;
        if (x.levels === 0) {
            H = 0
        } else {
            if (!x.specialVersion) {
                H = 1
            }
        }
        E(D.projects, B);
        function A(K, J) {
            return K._refObjectName >= J._refObjectName
        }

        function I(J) {
            return J.substring(J.lastIndexOf("/") + 1, J.lastIndexOf("."))
        }

        function G(K, L) {
            for (var J = 0; J < K.length; J++) {
                if (K[J].ObjectID == L) {
                    return K[J]
                }
            }
            return null
        }

        function E(L, K, N) {
            var M = G(L, K);
            if (M === null || (typeof H !== "undefined" && N > H)) {
                return
            }
            if (typeof N === "undefined") {
                N = 0
            }
            if (M.State === "Open") {
                C[F] = {};
                C[F].Name = M._refObjectName;
                C[F].ObjectID = M.ObjectID;
                C[F++].Level = N
            }
            if (typeof M.Children !== "undefined" && M.Children.length > 0) {
                for (var J = 0; J < M.Children.length; J++) {
                    E(L, I(M.Children[J]._ref), N + 1)
                }
            }
        }

        return C
    }

    function r(z, A) {
        var D = "";
        var E = true;
        for (var B = 0; B < z.length; B++) {
            if (typeof z[B] !== "undefined") {
                if (E) {
                    D = C(z[B]);
                    E = false
                } else {
                    D = "(" + D + " OR " + C(z[B]) + ")"
                }
            }
        }
        function C(F) {
            return"(" + A + " = " + F + ")"
        }

        return D
    }

    function q() {
        var B = x.projectOidsInScope.split(",");
        var A = r(B, "ObjectID");
        var C = {key:"projects", type:"project", query:A, fetch:"ObjectID,Name,State,Children", order:"Name"};
        try {
            e.findAll(C, p)
        } catch (z) {
            console.error(z)
        }
    }

    function k() {
        var A = document.getElementById("title");
        var z;
        if (x.burndownUnits === "story") {
            z = "plan estimates"
        } else {
            z = "to do"
        }
        if (x.specialVersion) {
            A.innerHTML = x.mashupType + " Dashboard (" + z + ")"
        } else {
            A.innerHTML = x.mashupType + " Dashboard"
        }
    }

    function h(A) {
        x = {workspaceOid:A.workspaceOid, projectOid:A.projectOid, timeboxType:x.timeboxType, levels:1, showBurndownChart:true, showTestCaseChart:true, showDefectChart:true, showScheduledWorkChart:true, showTitle:true, chartWidth:(x.browserWidth - 200) / 4};
        for (var z in A) {
            if (A.hasOwnProperty(z)) {
                x[z] = A[z]
            }
        }
    }

    this.display = function (z) {
        h(z);
        q()
    };
    this.applyConfig = function (z) {
        h(z)
    };
    this.parseProjectTree = function (A, z) {
        return j(A, z)
    };
    return f
};</script>

<script type="text/javascript" description="User Settings">
    var WORKSPACE_OID = '__WORKSPACE_OID__';

    //  Top-level project to display
    var PROJECT_OID = '__PROJECT_OID__';

    // Comma-separated list of project OIDs, consisting of PROJECT_OID and all its children.
    var PROJECT_OIDS_IN_SCOPE = '__PROJECT_OIDS_IN_SCOPE__';

    var SCOPE_UP = '__PROJECT_SCOPING_UP__';
    var SCOPE_DOWN = '__PROJECT_SCOPING_DOWN__';
</script>

<script type="text/javascript" description="mashup constants">
    var MASHUP_TYPE = RALLY.Mashup.ITERATION;
    var TIMEBOX_TYPE = RALLY.Mashup.ITERATION;
    var SPECIAL_VERSION = false;
    var BURNDOWN_UNITS = 'todo';
    var CHART_WIDTH, WIDGET_MODE;
</script>

</head>
<body class="nihilo">
<div style="float:left" id="title" class="titlebar"></div>
<div id="helpAndActions">
    <div style="float:right" id="help"></div>
    <table>
        <tr>
            <td style="text-align: left; width: 99%;"></td>
            <td style="text-align: right; width: 1%;">
                <img id="do" onmouseover="RALLY.Mashup.Utilities.showcbButton();"
                     onmouseout="hidecbMenu('buttons',event);"
                     style="vertical-align: middle;"
                     src="/slm/images/menu_actions.gif"/>

                <div style="position:relative;top:5px" align="left">
                    <div id="buttons" class="do-menu" style="left:0px;"
                         onmouseover="document.body.style.cursor='pointer';"
                         onmouseout="document.body.style.cursor='default';hidecbMenu('buttons',event);">
                        <a id="print" onclick="RALLY.Mashup.Utilities.printPage();">Print...</a>
                    </div>
                </div>
            </td>
        </tr>
    </table>
</div>
<div style="clear:both"></div>
<div id='warning' class="dashboard-warning"></div>
<table>
    <tr>
        <td id="timeboxLabel" class="timeboxLabel">Timebox Name</td>
        <td><select id="timeboxList"></select></td>
    </tr>
</table>
<div id="spinner"></div>
<div id="legendDiv" class="dijitTitlePaneTitle">
    <div id="placeholder1" style="float:left"></div>
    <div id="placeholder2" style="float:left"></div>
    <div id="placeholder3" style="float:left"></div>
    <div style="clear:both"></div>
</div>
<div id="charts" class="dashboard-frame"></div>
</body>
</html>